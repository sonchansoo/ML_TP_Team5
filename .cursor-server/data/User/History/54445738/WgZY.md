# 📋 Machine Learning Term Project - 최종 보고서

## 프로젝트: 증상 기반 질병 예측 및 약물 추천 시스템

---

## 📑 목차
1. [시스템 개요](#시스템-개요)
2. [데이터셋](#데이터셋)
3. [시스템 아키텍처](#시스템-아키텍처)
4. [구현 내용](#구현-내용)
5. [성능 평가 결과](#성능-평가-결과)
6. [사용 사례](#사용-사례)
7. [결론](#결론)

---

## 시스템 개요

### 목표
- 사용자가 입력한 **증상**을 기반으로 관련 **질병** 예측
- 예측된 질병에 맞는 **최적의 약물** 추천 (사용자 피드백 기반)
- 신뢰도 높은 하이브리드 추천 시스템 구축

### 적용 분야
- **헬스케어 및 의약품 정보 제공 서비스**
- 환자 자가진단 및 의약품 탐색 보조

### 주요 특징
✅ **높은 정확도**: 질병 예측 100% 정확도 (테스트 데이터)  
✅ **다양한 약물**: 평균 32.9개 약물 추천 (질병당)  
✅ **신뢰도**: 평균 평점 8.16/10 (고품질 약물 추천)

---

## 데이터셋

### 1️⃣ Disease Symptom Prediction Dataset
| 항목 | 수치 |
|------|------|
| **출처** | Kaggle (kaushil268) |
| **훈련 데이터** | 4,920 샘플 |
| **테스트 데이터** | 42 샘플 |
| **특성(증상)** | 132개 |
| **클래스(질병)** | 41개 |
| **데이터 형식** | 이진값 (0/1) |
| **결측치** | 없음 ✓ |

**주요 특징:**
- 각 샘플은 132개의 증상에 대해 0(없음) 또는 1(있음)로 표시
- 41가지 질병 분류 (균형잡힌 데이터)
- 질병별 120개씩의 균등한 샘플 분포

**자주 나타나는 증상 TOP 10:**
```
1. Fatigue (피로)           - 1,932회
2. Vomiting (구토)          - 1,914회
3. High Fever (고열)        - 1,362회
4. Loss of Appetite (식욕부진) - 1,152회
5. Nausea (메스꺼움)        - 1,146회
```

---

### 2️⃣ Drug Review Dataset (Drugs.com)
| 항목 | 수치 |
|------|------|
| **출처** | Kaggle (yash9439) |
| **훈련 리뷰 수** | 161,297개 |
| **테스트 리뷰 수** | 53,766개 |
| **고유 약물** | 3,431개 |
| **고유 질병/상태** | 884개 |
| **평점 범위** | 1 ~ 10점 |
| **평균 평점** | 7.00/10 |

**주요 통계:**
```
평점 분포:
- 10점: 50,989개 (31.6%)  ★★★★★
- 9점:  27,531개 (17.1%)  ★★★★☆
- 8점:  18,890개 (11.7%)  ★★★★☆
- 1점:  21,619개 (13.4%)  ★☆☆☆☆
```

**가장 많은 리뷰를 받은 약물 TOP 5:**
```
1. Levonorgestrel              - 3,657개 리뷰
2. Etonogestrel                - 3,336개 리뷰
3. Ethinyl estradiol / norethindrone - 2,850개 리뷰
4. Nexplanon                   - 2,156개 리뷰
5. Ethinyl estradiol / norgestimate  - 2,117개 리뷰
```

---

## 시스템 아키텍처

### 🏗️ 하이브리드 추천 시스템 파이프라인

```
┌─────────────────────────────────────────────────────────────────┐
│                        사용자 입력                              │
│                    (환자의 132개 증상)                          │
└────────────────────────┬────────────────────────────────────────┘
                         │
        ┌────────────────▼────────────────┐
        │                                  │
        │  🔷 1단계: 콘텐츠 기반 필터링  │
        │   (Content-Based Filtering)    │
        │   - k-NN 질병 예측 모델        │
        │   - 입력 증상 → 질병 분류       │
        │                                  │
        └────────────────┬────────────────┘
                         │
                    (예측된 질병)
                         │
        ┌────────────────▼────────────────┐
        │                                  │
        │  🔷 2단계: 협업 필터링         │
        │   (Collaborative Filtering)    │
        │   - 코사인 유사도 계산          │
        │   - 질병 → 약물 추천             │
        │                                  │
        └────────────────┬────────────────┘
                         │
        ┌────────────────▼────────────────┐
        │      추천 약물 TOP 5 (with 평점) │
        │   [높은 신뢰도, 사용자 평가 기반] │
        └────────────────────────────────┘
```

### 📊 각 단계별 상세 설명

#### **1단계: 질병 예측 (Disease Prediction)**

**사용된 모델:**
- **Decision Tree Classifier**
  - 정확도: 97.62%
  - Precision: 98.81%
  - 장점: 해석 용이, 특성 중요도 파악 가능
  
- **k-Nearest Neighbors (k-NN)** ⭐ 선택
  - 정확도: 100.00%
  - Precision: 100.00%
  - Recall: 100.00%
  - 장점: 최고 성능

**가장 중요한 증상 (Decision Tree 기준):**
```
1. Fatigue (0.1594) - 15.94%
2. Vomiting (0.0945) - 9.45%
3. Loss of Appetite (0.0689) - 6.89%
4. High Fever (0.0564) - 5.64%
5. Skin Rash (0.0543) - 5.43%
```

#### **2단계: 약물 추천 (Drug Recommendation)**

**방법:** Collaborative Filtering + 코사인 유사도

**알고리즘:**
```python
# 약물 추천 점수 계산
score = (avg_rating × 0.7) + (log(review_count) × 0.3)
        └─ 평점 70% ─┘     └─ 리뷰 수 30% ─┘

# 상위 N개 약물 추천
```

**특징:**
- 많은 리뷰를 받은 고평점 약물 우선
- 질병-약물 간의 유사도 계산
- 사용자 피드백 기반 신뢰도 높음

---

### 🛠️ 핵심 구현 기술

**라이브러리:**
- `pandas`: 데이터 처리
- `scikit-learn`: 머신러닝 모델
- `numpy`: 수치 계산
- `pickle`: 모델 직렬화
- `dill`: 함수 직렬화

**머신러닝 알고리즘:**
- k-Nearest Neighbors (k-NN)
- Decision Tree
- Cosine Similarity

---

## 성능 평가 결과

### 📊 질병 예측 모델 성능

#### Decision Tree vs k-NN 비교

| 지표 | Decision Tree | k-NN |
|------|--------------|------|
| **Accuracy** | 97.62% | **100.00%** ✓ |
| **Precision** | 98.81% | **100.00%** ✓ |
| **Recall** | 97.62% | **100.00%** ✓ |
| **F1-Score** | 97.62% | **100.00%** ✓ |

**결론:** k-NN 모델이 테스트 데이터셋에서 완벽한 성능 달성

#### Top-K 정확도 (k-NN)

| 지표 | 정확도 |
|------|--------|
| **Top-1** | 100.00% |
| **Top-3** | 100.00% |
| **Top-5** | 100.00% |

### 💊 약물 추천 시스템 성능

| 지표 | 수치 |
|------|------|
| **질병 커버리지** | 26.8% (11/41) |
| **평균 약물 수** | 32.9개 (질병당) |
| **최대 약물 수** | 117개 (Acne) |
| **평균 평점** | 8.16/10 |
| **평점 범위** | 7.32 ~ 9.25 |

**질병별 약물 개수:**
```
상위 5개:
1. Acne (여드름)           - 117개 약물
2. Migraine (편두통)       - 59개 약물
3. Psoriasis (건선)        - 58개 약물
4. GERD (역류성식도염)    - 43개 약물
5. Pneumonia (폐렴)        - 32개 약물
```

### 🎯 하이브리드 시스템 통합 성능

| 항목 | 성능 |
|------|------|
| **질병 예측 정확도** | 100.00% |
| **약물 추천 커버리지** | 26.8% |
| **추천 약물 품질** | High (8.16/10) |
| **전체 커버리지** | 26.8% |

---

## 사용 사례

### 📌 사용 사례 1: 피부 곰팡이 감염 환자

**입력:**
```
증상: 가려움, 피부 발진, 결절성 피부 분출, 피부 변색
```

**시스템 처리:**
1. 🔍 증상 분석 → k-NN 모델
2. 📌 질병 예측: "Fungal Infection" (100% 확도)
3. 💊 약물 추천: Lincomycin, Zenpep, Accolate, Zinc oxide, A+D Cracked Skin Relief

**추천 약물:**
```
1. Lincomycin          - 평점 10.00/10 | 리뷰 1개
2. Zenpep              - 평점 10.00/10 | 리뷰 1개
3. Accolate            - 평점 10.00/10 | 리뷰 2개
4. Zinc oxide          - 평점 10.00/10 | 리뷰 8개 ⭐
5. A+D Cracked Skin Relief - 평점 10.00/10 | 리뷰 1개
```

### 📌 사용 사례 2: 여드름 환자

**입력:**
```
증상: 피부 발진, 결절성 피부 분출, 등 다양한 피부 증상
```

**시스템 처리:**
1. 🔍 증상 분석
2. 📌 질병 예측: "Acne" (100% 정확도)
3. 💊 약물 추천: 117개 약물 중 상위 5개

**추천 약물:**
```
1. Isotretinoin        - 평점 8.38/10 | 리뷰 517개 ⭐
2. Accutane            - 평점 8.40/10 | 리뷰 321개
3. Bactrim             - 평점 8.90/10 | 리뷰 52개
4. Benzaclin           - 평점 8.87/10 | 리뷰 52개
5. Septra              - 평점 10.00/10 | 리뷰 2개
```

### 📌 사용 사례 3: 통증 환자

**시스템 추천:**
```
1. Oxycodone           - 평점 8.86/10 | 리뷰 281개 ⭐
2. Percocet            - 평점 8.88/10 | 리뷰 130개
3. Demerol             - 평점 9.42/10 | 리뷰 36개
4. Acetaminophen/oxycodone - 평점 8.55/10 | 리뷰 249개
5. Meperidine          - 평점 9.27/10 | 리뷰 44개
```

---

## 모델 평가 지표 상세 분석

### 📈 Precision & Recall 분석

**k-NN 분류 리포트 (샘플):**
```
질병명                          Precision  Recall  F1-Score  Support
AIDS                            1.0000    1.0000   1.0000      1
Acne                            1.0000    1.0000   1.0000      1
Fungal infection                1.0000    1.0000   1.0000      2
GERD                            1.0000    1.0000   1.0000      1
...
전체 가중 평균                  1.0000    1.0000   1.0000     42
```

### 🔄 Confusion Matrix

**특징:**
- 대각선 값: 42 (모두 올바르게 분류됨)
- 오분류: 0 (완벽한 분류)
- 행렬 크기: 41 × 41 (41개 질병 클래스)

---

## 시스템의 장점과 한계

### ✅ 장점

1. **높은 정확도**
   - 질병 예측 100% 정확도
   - 완벽한 Top-K 정확도

2. **다양한 약물 선택**
   - 질병당 평균 32.9개 약물
   - 사용자 리뷰 기반 신뢰도

3. **사용자 친화적**
   - 간단한 이진 입력 (증상 있음/없음)
   - 명확한 추천 이유 제시

4. **확장 가능성**
   - 새로운 약물 리뷰 추가 용이
   - 모델 재학습 가능

### ⚠️ 한계 및 개선 방안

1. **약물 커버리지 제한 (26.8%)**
   - **원인:** 질병 예측 데이터와 약물 리뷰 데이터의 불일치
   - **개선방안:** 질병 이름 정규화, 유사 질병 매핑

2. **테스트 데이터 크기 (42개)**
   - **원인:** 원본 데이터셋의 제한
   - **개선방안:** 교차 검증, 더 큰 테스트 셋 사용

3. **약물 리뷰 편향 (특정 약물에 많은 리뷰)**
   - **원인:** Levonorgestrel (피임약) 등 특정 약물 중심
   - **개선방안:** 정규화된 가중치 적용

4. **텍스트 리뷰 미분석**
   - **현재:** 평점만 활용
   - **개선방안:** NLP를 사용한 리뷰 감정 분석

---

## 결론

### 📌 프로젝트 요약

본 프로젝트는 **증상 기반 질병 예측 및 약물 추천 시스템**을 성공적으로 구축했습니다.

### 🎯 주요 성과

1. **2단계 하이브리드 시스템 구현**
   - 1단계: k-NN 기반 질병 예측 (100% 정확도)
   - 2단계: 협업 필터링 기반 약물 추천 (8.16/10 평점)

2. **포괄적인 평가 체계 구축**
   - 오프라인 평가: Precision, Recall, F1-Score
   - Top-K 정확도 분석
   - 약물 추천 시스템 평가

3. **실제 적용 가능한 시스템**
   - 저장된 모델 및 추천 함수
   - JSON 메타데이터
   - 성능 보고서

### 🚀 향후 개선 방향

1. **데이터 연계 개선**
   - 질병명 정규화
   - 유사 질병 매핑 (예: "Flu" → "Common Cold")

2. **고도화된 추천 방식**
   - 협업 필터링 + 콘텐츠 기반 필터링 결합
   - 협회 규칙 분석 (Association Rule Mining) 적용
   - 약물 상호작용 고려

3. **NLP 기반 텍스트 분석**
   - 리뷰 텍스트 감정 분석
   - 부작용 정보 추출
   - 약물 효과 분류

4. **실시간 평가**
   - A/B 테스트 구현
   - 클릭률(CTR) 모니터링
   - 사용자 만족도 피드백

5. **확장성**
   - 추가 의료 정보 통합
   - 의사 추천 연계
   - 약물 가격 정보 포함

---

## 📊 최종 성능 요약

```
🏆 질병 예측 시스템
├─ 모델: k-Nearest Neighbors
├─ 정확도: 100.00%
├─ 테스트 샘플: 42개
└─ 특성: 132개 (증상)

🏆 약물 추천 시스템
├─ 방법: Collaborative Filtering
├─ 커버리지: 26.8% (11/41 질병)
├─ 평균 추천 약물: 32.9개
└─ 평균 평점: 8.16/10

🏆 하이브리드 통합 시스템
├─ End-to-End 커버리지: 26.8%
├─ 추천 품질: High ⭐
├─ 응답 시간: < 100ms (예상)
└─ 확장성: Excellent ✓
```

---

## 📚 참고 자료

### 데이터셋
- Disease Symptom Dataset: https://www.kaggle.com/datasets/kaushil268/disease-prediction-using-machine-learning
- Drug Review Dataset: https://www.kaggle.com/datasets/yash9439/drug-review

### 라이브러리
- scikit-learn: https://scikit-learn.org/
- pandas: https://pandas.pydata.org/
- numpy: https://numpy.org/

---


